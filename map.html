<!DOCTYPE html>
<html>
<head>

    <title>Quick Start - Leaflet</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" crossorigin=""></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>



</head>
<body>



<div id="mapid" style="width: 1280px; height: 720px;"></div>

<h3>Control</h3>
<form>
    <input type="text" name="control_center_x" id="control_center_x" placeholder="control_center_x" class="input_receive_x">
    <input type="text" name="control_center_y" id="control_center_y" placeholder="control_center_y" class="input_receive_y">
    <input type="text" name="control_zoom" id="control_zoom" placeholder="control_zoom" value="13" class="input_receive_zoom">
    <input type="submit" id="submitControl">
    <script type="text/javascript">
        $("#submitControl").click(function(event){
            event.preventDefault();
            map1.setView([$("#control_center_x").val(), $("#control_center_y").val()], $("#control_zoom").val());
        });
    </script>
</form>


<button id="submitReset">Reset</button>
<script type="text/javascript">
    $("#submitReset").click(function(){
        dataArrMarkers = [];
        dataArrCircles = [];
        dataArrPolygons = [];
        dataTempPolygon = {coordinates:[], label:"temp", linecolor:"white"};
        dataArrPolylines = [];
        dataTempPolyline = {coordinates:[], label:"temp", linecolor:"white"};

        $("#marker_id").val("0");
        $("#circle_id").val("0");
        $("#polygon_id").val("0");
        $("#polyline_id").val("0");

        updateMap();
        updateTable();
    });
</script>


<h3>Markers</h3>
<table id="tableMarker" border="1">
    <tr>
        <th>ID</th>
        <th>Coordinate</th>
        <th>Label</th>
        <tbody id="tableBodyMarker"></tbody>
    </tr>
</table>
<form>
    <input type="text" name="marker_id" id="marker_id" placeholder="marker_id" value="0">
    <input type="text" name="marker_x" id="marker_x" placeholder="marker_x" class="input_receive_x" value="51.508">
    <input type="text" name="marker_y" id="marker_y" placeholder="marker_y" class="input_receive_y" value="-0.11">
    <input type="text" name="marker_label" id="marker_label" placeholder="marker_label" value="marker 0">
    <select name="marker_icon" id="marker_icon">
        <option value='red'>red</option>
        <option value='purple'>purple</option>
        <option value='pink'>pink</option>
        <option value='cyan'>cyan</option>
        <option value='gray'>gray</option>
        <option value='black'>black</option>
        <option value='white'>white</option>
        <option value='yellow'>yellow</option>
        <option value='green'>green</option>
        <option value='blue'>blue</option>
    </select>
    <input type="submit" id="submitMarker">
    <script type="text/javascript">
        $("#submitMarker").click(function(event){
            event.preventDefault();

            dataArrMarkers[parseInt($("#marker_id").val())] = {
                coordinate: [
                    parseFloat($("#marker_x").val()),
                    parseFloat($("#marker_y").val())
                ],
                label: $("#marker_label").val(),
                icon: $("#marker_icon").val()
            };

            updateMap();
            updateTable();
            $("#marker_label").val("marker " + (dataArrMarkers.length));
            $("#marker_id").val((dataArrMarkers.length));
        });
    </script>
</form>


<h3>Circles</h3>
<table id="tableCircle" border="1">
    <tr>
        <th>ID</th>
        <th>Color</th>
        <th>Center</th>
        <th>Radius</th>
        <th>Label</th>
        <tbody id="tableBodyCircle"></tbody>
    </tr>
</table>
<form>
    <input type="text" name="circle_id" id="circle_id" placeholder="circle_id" value="0">
    <input type="text" name="circle_center_x" id="circle_center_x" placeholder="circle_center_x" class="input_receive_x" value="51.508">
    <input type="text" name="circle_center_y" id="circle_center_y" placeholder="circle_center_y" class="input_receive_y" value="-0.11">
    <input type="text" name="circle_radius" id="circle_radius" placeholder="circle_radius" value="500">
    <input type="text" name="circle_label" id="circle_label" placeholder="circle_label" value="circle 0">
    <input type="text" name="circle_fillcolor" id="circle_fillcolor" placeholder="circle_fillcolor" value="green">
    <input type="text" name="circle_linecolor" id="circle_linecolor" placeholder="circle_linecolor" value="white">
    <input type="submit" id="submitCircle">
    <script type="text/javascript">
        $("#submitCircle").click(function(event){
            event.preventDefault();

            dataArrCircles[parseInt($("#circle_id").val())] = {
                coordinate_center: [
                    parseFloat($("#circle_center_x").val()),
                    parseFloat($("#circle_center_y").val())
                ],
                radius: parseFloat($("#circle_radius").val()),
                label: $("#circle_label").val(),
                fillcolor: $("#circle_fillcolor").val(),
                linecolor: $("#circle_linecolor").val()
            };

            updateMap();
            updateTable();
            $("#circle_label").val("circle " + (dataArrCircles.length));
            $("#circle_id").val((dataArrCircles.length));
        });
    </script>
</form>

<h3>Polygons</h3>
<table id="tablePolygon" border="1">
    <tr>
        <th>ID</th>
        <th>NumOfVertex</th>
        <th>Line Color</th>
        <th>Label</th>
        <tbody id="tableBodyPolygon"></tbody>
    </tr>
</table>
<form>
    <input type="text" name="polygon_id" id="polygon_id" placeholder="polygon_id" value="0">
    <input type="text" name="polygon_label" id="polygon_label" placeholder="polygon_label" value="polygon 0">
    <input type="text" name="polygon_linecolor" id="polygon_linecolor" placeholder="polygon_linecolor" value="blue">
    <input type="text" name="polygon_x_last" id="polygon_x_last" placeholder="polygon_x_last" class="input_receive_x" value="51.508">
    <input type="text" name="polygon_y_last" id="polygon_y_last" placeholder="polygon_y_last" class="input_receive_y" value="-0.11">
    <div id="container_polygon_vertex"></div>
    <input type="submit" id="submitPolygonVertex" value="Add Vertex">
    <input type="submit" id="submitPolygon">
    <script type="text/javascript">
        $("#submitPolygonVertex").click(function(event){
            event.preventDefault();

            var current_x = $("#polygon_x_last").val();
            var current_y = $("#polygon_y_last").val();
            $("#container_polygon_vertex").append('<input type="text" placeholder="polygon_x" class="polygon_x" value="'+current_x+'">');
            $("#container_polygon_vertex").append('<input type="text" placeholder="polygon_y" class="polygon_y" value="'+current_y+'">');
            dataTempPolygon.coordinates.push([current_x,current_y]);

            updateMap();
            updateTable();
        });

        $("#submitPolygon").click(function(event){
            event.preventDefault();

            temp_coordinates = [];
            var num_of_vertex = $(".polygon_x").length;
            for (var i = 0; i < num_of_vertex; i++) {
                var current_x = $($(".polygon_x")[i]).val();
                var current_y = $($(".polygon_y")[i]).val();
                temp_coordinates.push([current_x, current_y]);
            }
            dataArrPolygons[parseInt($("#polygon_id").val())] = {
                coordinates: temp_coordinates,
                label: $("#polygon_label").val(),
                linecolor: $("#polygon_linecolor").val()
            };

            dataTempPolygon = {coordinates:[], label:"temp", linecolor:"white"};

            updateMap();
            updateTable();
            $("#polygon_label").val("polygon " + (dataArrPolygons.length));
            $("#polygon_id").val((dataArrPolygons.length));

            $("#container_polygon_vertex").html("");
        });
    </script>
</form>


<h3>Polylines</h3>
<table id="tablePolyline" border="1">
    <tr>
        <th>ID</th>
        <th>NumOfVertex</th>
        <th>Line Color</th>
        <th>Label</th>
        <tbody id="tableBodyPolyline"></tbody>
    </tr>
</table>
<form>
    <input type="text" name="polyline_id" id="polyline_id" placeholder="polyline_id" value="0">
    <input type="text" name="polyline_label" id="polyline_label" placeholder="polyline_label" value="polyline 0">
    <input type="text" name="polyline_linecolor" id="polyline_linecolor" placeholder="polyline_linecolor" value="blue">
    <input type="text" name="polyline_x_last" id="polyline_x_last" placeholder="polyline_x_last" class="input_receive_x" value="51.508">
    <input type="text" name="polyline_y_last" id="polyline_y_last" placeholder="polyline_y_last" class="input_receive_y" value="-0.11">
    <div id="container_polyline_vertex"></div>
    <input type="submit" id="submitPolylineVertex" value="Add Vertex">
    <input type="submit" id="submitPolyline">
    <script type="text/javascript">
        $("#submitPolylineVertex").click(function(event){
            event.preventDefault();

            var current_x = $("#polyline_x_last").val();
            var current_y = $("#polyline_y_last").val();
            $("#container_polyline_vertex").append('<input type="text" placeholder="polyline_x" class="polyline_x" value="'+current_x+'">');
            $("#container_polyline_vertex").append('<input type="text" placeholder="polyline_y" class="polyline_y" value="'+current_y+'">');
            dataTempPolyline.coordinates.push([current_x,current_y]);

            updateMap();
            updateTable();
        });

        $("#submitPolyline").click(function(event){
            event.preventDefault();

            temp_coordinates = [];
            var num_of_vertex = $(".polyline_x").length;
            for (var i = 0; i < num_of_vertex; i++) {
                var current_x = $($(".polyline_x")[i]).val();
                var current_y = $($(".polyline_y")[i]).val();
                temp_coordinates.push([current_x, current_y]);
            }
            dataArrPolylines[parseInt($("#polyline_id").val())] = {
                coordinates: temp_coordinates,
                label: $("#polyline_label").val(),
                linecolor: $("#polyline_linecolor").val()
            };

            dataTempPolyline = {coordinates:[], label:"temp", linecolor:"white"};

            updateMap();
            updateTable();
            $("#polyline_label").val("polyline " + (dataArrPolylines.length));
            $("#polyline_id").val((dataArrPolylines.length));

            $("#container_polyline_vertex").html("");
        });
    </script>
</form>

<script>

function initMap(argMapHtmlId, argCenterArr, argCenterZoom, argMaxZoom)
{
    var mymap = L.map(argMapHtmlId).setView(argCenterArr, argCenterZoom);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
        maxZoom: argMaxZoom,
        attribution: '',
        id: 'mapbox.streets'
    }).addTo(mymap);

    var popup = L.popup();
    mymap.on('click', function (e) {
        popup
            .setLatLng(e.latlng)
            .setContent("Position: " + e.latlng.lat.toString() + " , " + e.latlng.lng.toString())
            .openOn(mymap);

        //console.log(e.latlng.lat);
        $(".input_receive_x").val(e.latlng.lat);
        $(".input_receive_y").val(e.latlng.lng);
    });
    mymap.on('zoom', function (e) {
        //console.log(e.target._zoom);
        $(".input_receive_zoom").val(e.target._zoom);
    });
    return mymap;
}

function updateMap(){
    var item = null;

    // remove all layer first
    map1.eachLayer(function (layer) {
        if(layer._url == undefined) map1.removeLayer(layer);
    });

    /*
    var LeafIcon = L.Icon.extend({
        options: {
            shadowUrl: 'gray.png',
            iconSize:     [38, 95],
            shadowSize:   [50, 64],
            iconAnchor:   [22, 94],
            shadowAnchor: [4, 62],
            popupAnchor:  [-3, -76]
        }
    });
    var iconMarker = {
        red: new LeafIcon({iconUrl: 'red.png'}),
        purple: new LeafIcon({iconUrl: 'purple.png'}),
        pink: new LeafIcon({iconUrl: 'pink.png'}),
        cyan: new LeafIcon({iconUrl: 'cyan.png'}),
        gray: new LeafIcon({iconUrl: 'gray.png'}),
        black: new LeafIcon({iconUrl: 'black.png'}),
        white: new LeafIcon({iconUrl: 'white.png'}),
        yellow: new LeafIcon({iconUrl: 'yellow.png'}),
        green: new LeafIcon({iconUrl: 'green.png'}),
        blue: new LeafIcon({iconUrl: 'blue.png'}),
    };
    */

    // add markers
    for (var i = 0; i < dataArrMarkers.length; i++)
    {
        item = dataArrMarkers[i];
        var markerOption = {icon: L.icon({
            iconUrl: item.icon + '.png',
            iconSize: [25, 37], // size of the icon
            iconAnchor: [13, 34] // location of the "tip" of the icon (relative to its top left corner). The icon will be aligned so that this point is at the marker's geographical location
        })};
        L.marker(item.coordinate, markerOption).addTo(map1).bindPopup(item.label);
    }

    // add new circles
    for (var i = 0; i < dataArrCircles.length; i++) {
        item = dataArrCircles[i];
        if(item.linecolor == undefined) item.linecolor = "white";
        if(item.fillcolor == undefined) item.fillcolor = "green";
        L.circle(item.coordinate_center, item.radius, {
                color: item.linecolor,
                fillColor: item.fillcolor,
                fillOpacity: 0.5
            }).addTo(map1).bindPopup(item.label);
    }

    // add new polygon
    for (var i = 0; i < dataArrPolygons.length; i++) {
        item = dataArrPolygons[i];
        L.polygon(item.coordinates, {color: item.linecolor}).addTo(map1).bindPopup(item.label);
    }
    // temporary polygon
    //if(tempPolygon != null && tempPolygon != undefined) tempPolygon.remove();
    if(dataTempPolygon.coordinates.length > 1)
        tempPolygon = L.polygon(dataTempPolygon.coordinates, {color: dataTempPolygon.linecolor}).addTo(map1).bindPopup(dataTempPolygon.label);

    // add new polyline
    for (var i = 0; i < dataArrPolylines.length; i++) {
        item = dataArrPolylines[i];
        L.polyline(item.coordinates, {color: item.linecolor}).addTo(map1).bindPopup(item.label);
    }
    // temporary polyline
    //if(tempPolyline != null && tempPolyline != undefined) tempPolyline.remove();
    if(dataTempPolyline.coordinates.length > 1)
        tempPolyline = L.polyline(dataTempPolyline.coordinates, {color: dataTempPolyline.linecolor}).addTo(map1).bindPopup(dataTempPolyline.label);


}

function updateTable() {
    $("#tableBodyCircle").html("");
    for (var i = 0; i < dataArrCircles.length; i++) {
        item = dataArrCircles[i]; // id, color, center, radius

        $("#tableBodyCircle").append("<tr>"+
            "<td>"+i+"</td>"+
            "<td>"+item.fillcolor+" - "+item.linecolor+"</td>"+
            "<td>"+item.coordinate_center[0]+" , "+item.coordinate_center[1]+"</td>"+
            "<td>"+item.radius+"</td>"+
            "<td>"+item.label+"</td>"+
        "</tr>");
    }
    $("#tableBodyMarker").html("");
    for (var i = 0; i < dataArrMarkers.length; i++) {
        item = dataArrMarkers[i]; // id, coordinate, radius

        $("#tableBodyMarker").append("<tr>"+
            "<td>"+i+"</td>"+
            "<td>"+item.coordinate[0]+" , "+item.coordinate[1]+"</td>"+
            "<td>"+item.label+"</td>"+
        "</tr>");
    }
    $("#tableBodyPolygon").html("");
    for (var i = 0; i < dataArrPolygons.length; i++) {
        item = dataArrPolygons[i]; // id, number vertex, color, label

        $("#tableBodyPolygon").append("<tr>"+
            "<td>"+i+"</td>"+
            "<td>"+item.coordinates.length+"</td>"+
            "<td>"+item.linecolor+"</td>"+
            "<td>"+item.label+"</td>"+
        "</tr>");
    }
    $("#tableBodyPolyline").html("");
    for (var i = 0; i < dataArrPolylines.length; i++) {
        item = dataArrPolylines[i]; // id, number vertex, color, label

        $("#tableBodyPolyline").append("<tr>"+
            "<td>"+i+"</td>"+
            "<td>"+item.coordinates.length+"</td>"+
            "<td>"+item.linecolor+"</td>"+
            "<td>"+item.label+"</td>"+
        "</tr>");
    }
}

var map1 = initMap(
    'mapid', // map html id
    [52.5095347703273, 13.390960693359377], // center of map
    13, 18 // zoom and max zoom
);
var dataArrMarkers = [];
var dataArrCircles = [];
var dataArrPolygons = [];
var dataTempPolygon = {coordinates:[], label:"temp", linecolor:"white"};
var dataArrPolylines = [];
var dataTempPolyline = {coordinates:[], label:"temp", linecolor:"white"};

</script>

<script type="text/javascript">
    // shortcut
    $(document).keypress(function(event){
        //console.log(event.charCode); // l=108
        //console.log(event.target.tagName);
        if(event.target.tagName.toLowerCase() == "input") return;

        if(event.charCode==99){
            $("#submitCircle").trigger("click"); // c=99 // add new circle
        } else if(event.charCode==109){
            $("#submitMarker").trigger("click"); // m=109 // add new marker
        } else if(event.charCode==96){
            $("#submitReset").trigger("click"); // r=114 or tilde=96 // remove / reset all
        } else if(event.charCode==111){
            $("#submitPolygonVertex").trigger("click"); // o=111 // o is beside p (make polygon vertex)
        } else if(event.charCode==112){
            $("#submitPolygon").trigger("click"); // p=112 // add new polygon
        } else if(event.charCode==107){
            $("#submitPolylineVertex").trigger("click"); // k=107 // k is beside l (make polyline vertex)
        } else if(event.charCode==108){
            $("#submitPolyline").trigger("click"); // l=108 // add new polyline
        }
    });
</script>
<script type="text/javascript">
      $("[placeholder]").each(function() {
          var ph = this.placeholder;
          //$(this).removeAttr("placeholder");
          $(this).wrap("<div><label class=" + ph + "-label>" + ph + ":</label>");
      })
</script>


</body>
</html>
